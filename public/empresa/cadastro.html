<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div>
        <input type="radio" name="opcao" id="input_nao_filial">
        <label for="input_nao_filial">Não é Filial</label>
        <input type="radio" name="opcao" id="input_filial">
        <label for="input_filial">É Filial</label>
    </div>

    <div id="naoFilial">
        <div>
            <label for="">Nome fantasia:</label>
            <input type="text" id="input_nomeFantasia">
        </div>
        <div>
            <label for="">RazaoSocial</label>
            <input type="text" id="input_razaoSocial">
        </div>
        <div>
            <label for="">CNPJ</label>
            <input type="text" id="input_cnpj">
        </div>
    </div>
    <div id="filial">
        <select name="empresas" id="select_empresas">
        
        </select>
    </div>



    <div>
        <button onclick="cadastrar()">Cadastrar empresa</button>
    </div>

    <script>
        var listaEmpresas = [];
        var selectEmpresas = document.getElementById('select_empresas');
        var divCadastro = document.getElementById('cadastro');

        fetch("/empresas/buscarEmpresas").then(res => {
            if(!res.ok){
                throw new Error(`Erro na solicitação: ${res.statusText}`);
            }
            return  res.json();
        })
        .then(res => {
            listaEmpresas = res;
            enviarDadosSelect();
        })
        
        function enviarDadosSelect(){
            listaEmpresas.forEach(element => {
                const option = document.createElement('option');
                option.text = element.nome_fantasia;
                option.value = element.id_empresa;
                selectEmpresas.appendChild(option);
            });
        }

        const radioInputs = document.querySelectorAll('input[type="radio"]');

        radioInputs.forEach(input => {
            input.addEventListener('change', event => {
                if(document.getElementById('input_filial').checked){
                    document.getElementById('naoFilial').style.display = 'none'
                    document.getElementById('filial').style.display = 'block'
                }else{
                    document.getElementById('naoFilial').style.display = 'block'
                    document.getElementById('filial').style.display = 'none'
                }
            })
        })
        
        if(document.getElementById('input_filial').checked){
            divCadastro.innerHTML = "tteste"
        }

        function cadastrar(){
            var nome = input_nomeFantasia.value;
            var razaoSocial = input_razaoSocial.value;
            var cnpj = input_cnpj.value;
            var filial;

            if(document.getElementById('input_filial').checked){
                filial = true;
            }else{
                filial = false;
            }

            fetch("/empresas/cadastrar", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    nomeServer: nome,
                    razaoServer: razaoSocial,
                    cnpjServer: cnpj,
                    filialServer: filial
                })
            })
            .then(function (resposta) {
                console.log("resposta:",resposta)

                if (resposta.ok) {

                    console.log("Cadastro realizado com sucesso")

                } else {
                    console.log("Houve um erro ao tentar realizar o cadastro!");
                }

            }).catch(function (erro) {
                console.log(erro);
            })

            return false;
        }

    </script>
</body>
</html>