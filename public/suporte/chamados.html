<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/384071f692.js" crossorigin="anonymous"></script>
    <script src="../js/usuario.js"></script>
    <link rel="stylesheet" href="../css/dashboards.css">
    <link rel="stylesheet" href="../css/suporte/chamados.css">
    <title>Meus Chamados</title>
</head>

<body onload="listarChamados(),exibirNomeUsuario()">
    <section class="section-body">
        <div class="leftbar">
            <div class="links-nav">
                <img class="logo text-logo" src="https://i.imgur.com/RjhX0a9.png" alt="">
                <a class="nav-btn" href="visao_geral.html"><i class="fa-solid fa-border-all"></i><span>Visão Geral</span></a>
                <a class="nav-btn" href="dashboard.html"><i class="fa-solid fa-square-poll-vertical"></i><span>Dashboard</span></a>
                <a class="nav-btn" href="artigos.html"><i class="fa-solid fa-book"></i><span>Artigos</span></a>
                <a class="nav-btn btn-ativo" href="#"><i class="fa-solid fa-list"></i><span>Chamados</span></a>
            </div>
            <div class="cfg-nav">
                <a class="nav-btn" onclick="sair()"><i class="fa-solid fa-arrow-right-from-bracket"></i><span>Sair</span></a>
            </div>
        </div>
        <div class="main">
            <div class="upbar">
                <div class="profile-container">
                    <div class="user-wrap">
                        <img src="../img/user_placeholder.png" class="img-user">
                        <span id="nome-usuario">Usuário</span>
                        <i class="fa-solid fa-angle-down"></i>
                    </div>
                    <div>
                        <i class="fa-solid fa-bell"></i>
                    </div>
                </div>
            </div>



            <!--LISTA DE TAREFAS PENDENTES GERAL-->
            <div class="container">
                
                <div class="lista-chamados">
                    <h2>Chamados Geral</h2>
                    <table id="tabela-artigo">
                        <thead>
                            <tr>
                                <th>Assunto</th>
                                <th>Descrição</th>
                                <th class="descricao">Tipo</th>
                                <th>Operador</th>
                                <th>Data</th>
                            </tr>
                        </thead>
                        <tbody id="chamados-aberto">

                        </tbody>
                    </table>
                </div>

                <!--LISTA DE TAREFAS PENDENTES UNITÁRIA-->
                <div class="lista-chamados">
                    <h2>Meus Chamados</h2>
                    <table id="tabela-artigo">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Descrição</th>
                                <th class="descricao">Tipo</th>
                                <th>Criação</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody id="chamados-andamento">
                        </tbody>
                    </table>
                </div>
            </div>

            <!--LISTA DE TAREFAS CONCLUÍDAS-->
            <div class="container-lista">
                
                <div class="listaArtigo">
                    <h2 id="chamados-concluidos">Chamados Concluídos</h2>
                    <table id="tabela-artigo">
                        <thead>
                            <tr>
                                <th>Título</th>
                                <th>Descrição</th>
                                <th class="descricao">Tipo</th>
                                <th>Criação</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody id="chamados-finalizados">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>
</body>

</html>
<script>
    const id_empresa = sessionStorage.ID_EMPRESA_USUARIO;
    const id_usuario = sessionStorage.ID_USUARIO;
    listaChamados = [];
    
    function buscarChamados() {
        fetch(`/usuarios/buscarChamadosSuporte?idEmpresa=${id_empresa}`)
        .then(res => {
            if (!res.ok) {
                throw new Error(`Erro na solicitação: ${res.statusText}`);
            }
            return res.json();
        })
        .then(data => {
            listaChamados = data;
            listarChamados()
        })
        .catch(error => {
            console.error('Erro ao buscar tarefas:', error);
        });
    }

    function listarChamados() {

        listaChamados.forEach(element => {
            var statusView = "" // id do elemento view
            if (element.resolvido == 0){ // Chamados aberto
                statusView = "chamados-aberto"
            } else if(element.resolvido == 1 && element.fk_atribuido == id_usuario){ // Chamados em andamento atribuidos ao suporte logado
                statusView = "chamados-andamento"
            } else if(element.resolvido == 2 && element.fk_atribuido == id_usuario){ // Chamados finalizados pelo suporte logado
                statusView = "chamados-finalizados"
            } 
            // 
            document.getElementById(`${statusView}`).innerHTML +=   `
                                                                    <tr>
                                                                        <th>${element.titulo}</th>
                                                                        <th>${element.descricao}</th>
                                                                        <th class="descricao">${element.tipo}</th>
                                                                        <th>${element.username}</th>
                                                                        <th>${element.dt_criado}</th>
                                                                    </tr>
                                                                    `
        });
        
    }
</script>
